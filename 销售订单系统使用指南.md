# 销售订单系统使用指南

## 🎯 系统目标
在前端输入销售订单数据 → 后端保存 → 导出Excel（匹配模板格式）

---

## ✅ 系统已准备就绪

### 当前状态
- ✅ 后端服务运行中：http://localhost:3001
- ✅ 前端服务运行中：http://localhost:3000
- ✅ 数据库已有基础数据：
  - 2个客户（东阳市测试客户、杭州市铭品贸易）
  - 1个业务员（张三）
  - 5个产品SKU

---

## 📝 操作步骤

### 第一步：打开订单创建页面

在浏览器访问：
```
http://localhost:3000/admin/orders/create
```

### 第二步：填写订单基本信息

**必填项**：
- **订单号**：自动生成（如：SO20251031-1234）
- **客户**：从下拉框选择（东阳市测试客户 或 杭州市铭品贸易）
- **业务员**：从下拉框选择（张三）
- **客户类型**：选择 新客户/老客户
- **订单类型**：选择 正式订单/意向订单
- **订单日期**：默认今天，可修改

**可选项**：
- **公司名称**：如"东阳市铭品日用品有限公司"（会显示在Excel第一行）

### 第三步：添加订单明细

点击"添加明细"按钮，每个明细包含：

#### 📌 基础信息（必填）
- **产品SKU**：从下拉框选择产品
- **数量**：输入数量（如：3000）
- **单价**：输入单价（如：10.5）

💡 **小计会自动计算**：数量 × 单价

#### 📦 基础信息（可选，展开查看更多）
- **预交日**：交货日期
- **客户料号**：客户的产品编号
- **货品规格**：产品详细规格描述
- **附加属性**：如颜色、尺寸等

#### 📦 包装信息（可选，点击"展开包装信息"）
- 包装换算：24
- 包装单位：125箱
- 重量单位：kg
- 包装净重：0
- 包装毛重：0
- 包装类型：纸箱
- 包装大小：标准
- 装箱数：24
- 箱数：125
- 箱规：74*44*20cm
- 体积：0.065

#### 📋 其他信息（可选，点击"展开其他信息"）
- 纸卡编码：3700703984511
- 水洗标编码：有水洗标，无编码
- 外箱编码：23700281004513
- 包装方式：单个卡头
- 厂商备注：备注信息
- 摘要：订单摘要

### 第四步：添加更多明细（可选）

- 点击"添加明细"可以添加多个产品
- 点击"删除"可以删除某个明细
- **订单总金额会自动累加所有明细的小计**

### 第五步：提交订单

- 检查所有信息是否正确
- 检查订单总金额是否正确
- 点击"创建订单"按钮
- 等待成功提示："订单创建成功！"
- 页面会自动跳转到订单列表

### 第六步：查看和导出订单

在订单列表页面（http://localhost:3000/admin/orders）：
- 可以看到刚才创建的订单
- 显示：订单号、客户、业务员、日期、总金额、状态
- 点击"导出"按钮 → 自动下载Excel文件
- 文件名格式：`SalesOrder_订单号_时间戳.xlsx`

### 第七步：检查Excel文件

打开下载的Excel文件，应该包含：
- **第1行**：公司名称（居中显示）
- **第2行**：销售订单 标题
- **第5行**：系统自带 | 销售填写（分类标签）
- **第6行**：28列表头（项、品号、客户料号...摘要）
- **第7行起**：你输入的订单明细数据
- **最后**：自动合计总额（未税本位币、体积）

---

## 💡 使用技巧

### 1. 快速填写订单
如果只需要基础信息，只填写必填项即可：
- 产品SKU
- 数量
- 单价

其他字段都是可选的，可以不填。

### 2. 分阶段填写
第一次使用可以只填基础信息，熟悉流程后再逐步填写包装信息和其他信息。

### 3. 折叠面板
- 默认只显示基础字段
- 点击"展开包装信息"查看包装相关字段
- 点击"展开其他信息"查看其他字段
- 点击"收起"可以折叠面板

### 4. 多明细管理
- 第一个明细默认展开
- 后续添加的明细默认收起（节省空间）
- 点击明细标题可以展开/收起

---

## 🎨 界面说明

### 订单创建页面布局
```
┌─────────────────────────────────────┐
│  创建销售订单                        │
├─────────────────────────────────────┤
│  订单基本信息                        │
│  ┌───────────────────────────────┐  │
│  │ 订单号：[自动生成]           │  │
│  │ 客户：  [选择客户 ▼]         │  │
│  │ 业务员：[选择业务员 ▼]       │  │
│  │ ...                          │  │
│  └───────────────────────────────┘  │
│                                      │
│  订单明细                            │
│  ┌───────────────────────────────┐  │
│  │ 明细 #1 ▼                    │  │
│  │ ┌─ 基础信息 ─────────────┐  │  │
│  │ │ 产品SKU：[选择 ▼]      │  │  │
│  │ │ 数量：   [3000]        │  │  │
│  │ │ 单价：   [10.5]        │  │  │
│  │ │ 小计：   31500         │  │  │
│  │ └─────────────────────────┘  │  │
│  │ [展开包装信息 ▼]             │  │
│  │ [展开其他信息 ▼]             │  │
│  └───────────────────────────────┘  │
│  [+ 添加明细]                       │
│                                      │
│  订单总金额：¥31,500.00             │
│                                      │
│  [创建订单]                         │
└─────────────────────────────────────┘
```

---

## 📊 示例：创建一个简单订单

### 场景：创建一个拖把订单

**订单信息**：
- 客户：东阳市测试客户有限公司
- 业务员：张三
- 订单类型：正式订单
- 客户类型：新客户

**订单明细**：
- 产品：TB009-四孔雪尼尔拖把
- 数量：3000
- 单价：10.5
- 预交日：2025-12-31
- 箱规：74*44*20cm
- 体积：0.065

**操作步骤**：
1. 访问 http://localhost:3000/admin/orders/create
2. 选择客户、业务员
3. 点击"添加明细"
4. 选择产品，输入数量3000，单价10.5
5. （可选）点击"展开包装信息"，填写箱规和体积
6. 检查总金额：31,500
7. 点击"创建订单"
8. 在列表中找到订单，点击"导出"
9. 检查下载的Excel文件

---

## ❓ 常见问题

### Q1: 下拉框没有数据？
**A**: 需要先在系统中创建客户、业务员、产品等基础数据。当前系统已有测试数据可用。

### Q2: 订单号可以自己输入吗？
**A**: 可以修改自动生成的订单号，但建议使用系统生成的格式（SO+日期+时间）。

### Q3: 必须填写所有28个字段吗？
**A**: 不需要！只有产品SKU、数量、单价是必填的，其他都是可选字段。

### Q4: Excel导出的格式可以修改吗？
**A**: 当前格式严格匹配 `material/sample_table/sale_table.xls` 模板。如需修改，需要调整后端代码。

### Q5: 可以编辑已创建的订单吗？
**A**: 当前版本只支持修改订单状态，不支持修改订单内容。如需修改，需要删除后重新创建。

### Q6: 导出的Excel中文显示乱码？
**A**: 确保使用Excel 2007或更新版本打开，或使用WPS Office。

---

## 🔧 技术支持

### 检查服务状态
```bash
# 检查后端服务
netstat -ano | findstr :3001

# 检查前端服务
netstat -ano | findstr :3000
```

### 重启服务
```bash
# 重启后端
cd code/backend-api
pnpm run start:dev

# 重启前端
cd code/frontend
pnpm run dev
```

### 查看日志
- 后端日志：在运行 `pnpm run start:dev` 的终端窗口
- 前端日志：浏览器开发者工具（F12）→ Console 标签

---

## 📚 相关文档

- **ORDER_API_FIELDS.md** - 完整的API字段文档
- **SALES_ORDER_TESTING_GUIDE.md** - 详细测试指南
- **SALES_ORDER_IMPLEMENTATION_SUMMARY.md** - 技术实现总结

---

**开始使用吧！** 🎉

访问 http://localhost:3000/admin/orders/create 开始创建你的第一个销售订单！
