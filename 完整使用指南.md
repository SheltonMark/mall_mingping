# 🎉 销售订单系统 - 完整使用指南

## ✅ 系统架构（正确的业务流程）

```
客户（前端） → 输入订单数据 → 提交到后端
                                    ↓
管理员（后台） ← 查看订单列表 ← 后端保存订单
                ↓
            导出Excel表格
```

---

## 📍 访问地址

### 前端（客户下单）
```
http://localhost:3000/order-confirmation
```
**功能**：客户在这里输入完整的销售订单信息并提交

### 后端（管理员查看）
```
http://localhost:3000/admin/orders
```
**功能**：管理员查看所有订单、导出Excel

---

## 🎯 完整操作流程

### 第一步：客户在前端下单

1. **打开订单页面**
   ```
   http://localhost:3000/order-confirmation
   ```

2. **填写订单号**
   - 自动生成（如：SO20251031-123）
   - 可手动修改
   - 可点击"生成订单号"重新生成

3. **选择订单分类**
   - 客户类型：新客户 / 老客户
   - 订单类型：正式订单 / 意向订单
   - 产品类别：新产品 / 老产品 / 样品申请

4. **选择订单日期**
   - 默认今天
   - 可修改为其他日期

5. **填写客户信息**
   - 可搜索现有客户（如果数据库中有）
   - 或者填写新客户信息：
     - **必填**：公司名称、邮箱、电话、地址
     - **可选**：联系人、备注

6. **添加订单明细**（核心部分 - 28个字段）

   点击"+ 添加产品"，每个产品包含：

   **基础信息**（展开即可填写）：
   - **选择产品** * （必填）- 从下拉框选择
   - **客户料号** - 客户的产品编号
   - **数量** * （必填）- 输入数量
   - **单价** * （必填）- 自动填充或手动修改
   - **货品规格** - 产品详细规格描述
   - **附加属性** - 如颜色、尺寸等
   - **预交日** - 交货日期
   - **未税本位币** - 未税金额

   **包装信息**（点击展开查看）：
   - 包装换算
   - 包装单位
   - 装箱数
   - 箱数
   - 重量单位
   - 包装净重
   - 包装毛重
   - 包装类型
   - 包装大小
   - 包装方式
   - 箱规（如：74*44*20cm）
   - 体积

   **其他信息**（点击展开查看）：
   - 纸卡编码
   - 水洗标编码
   - 外箱编码
   - 厂商备注
   - 摘要

7. **查看订单总金额**
   - 自动计算所有明细的小计之和
   - 显示在页面底部

8. **提交订单**
   - 检查所有必填项
   - 点击"确认订单"按钮
   - 等待提交成功
   - 3秒后自动跳转到订单查看页面

---

### 第二步：管理员在后台查看订单

1. **打开后台订单管理**
   ```
   http://localhost:3000/admin/orders
   ```

2. **查看订单列表**
   - 显示所有订单
   - 包含：订单号、客户、业务员、日期、总金额、状态

3. **导出Excel**
   - 找到要导出的订单
   - 点击该订单行的"导出"按钮
   - 浏览器自动下载Excel文件
   - 文件名：`SalesOrder_订单号_时间戳.xlsx`

4. **查看Excel内容**
   打开下载的Excel文件，应该看到：
   - 第1行：公司名称（东阳市铭品日用品有限公司）
   - 第2行：销售订单
   - 第5行：系统自带 | 销售填写
   - 第6行：28列完整表头
   - 第7行起：客户填写的所有订单明细数据
   - 最后：自动合计总额

---

## 💡 示例：创建一个完整订单

### 场景：客户要订购一批拖把

1. 访问：http://localhost:3000/order-confirmation

2. **订单基本信息**：
   - 订单号：SO20251031-001（自动生成）
   - 客户类型：新客户
   - 订单类型：正式订单
   - 产品类别：新产品
   - 订单日期：2025-10-31

3. **客户信息**：
   - 公司名称：杭州市测试贸易有限公司
   - 联系人：张经理
   - 邮箱：zhang@test.com
   - 电话：13800138000
   - 地址：浙江省杭州市西湖区测试路123号
   - 备注：紧急订单，请优先处理

4. **订单明细 #1**（点击展开）：

   **基础信息**：
   - 选择产品：TEST-001 - 测试产品组
   - 客户料号：CUST-TB009
   - 数量：3000
   - 单价：10.50（自动填充）
   - 货品规格：A伸缩铁杆φ19/22*0.3*120，白色喷塑+638C蓝色塑件
   - 附加属性：蓝色
   - 预交日：2025-12-31
   - 未税本位币：31500

   **包装信息**：
   - 包装换算：24
   - 包装单位：125箱
   - 装箱数：24
   - 箱数：125
   - 箱规：74*44*20cm
   - 体积：0.065

   **其他信息**：
   - 纸卡编码：3700703984511
   - 水洗标编码：有水洗标，无编码
   - 外箱编码：23700281004513
   - 包装方式：单个卡头
   - 摘要：紧急订单

5. **可选：添加更多明细**
   - 点击"+ 添加产品"按钮
   - 重复上述步骤填写第二个产品

6. **确认总金额**：
   - 订单总金额：¥31,500.00

7. **提交**：
   - 点击"确认订单"
   - 看到成功提示："订单创建成功！"
   - 3秒后自动跳转

8. **后台查看**：
   - 访问：http://localhost:3000/admin/orders
   - 找到订单号：SO20251031-001
   - 点击"导出"下载Excel

---

## 🔍 关键字段说明

### 必填字段（最少需要）
只要填写这些字段就能创建订单：
- ✅ 订单号
- ✅ 客户名称
- ✅ 客户邮箱
- ✅ 客户电话
- ✅ 客户地址
- ✅ 产品SKU（选择产品）
- ✅ 数量
- ✅ 单价

### 28个订单明细字段（完整版）
所有字段都已实现，分为三组：

**系统自带字段**（A-Q列）：
1. 项次
2. 品号（自动填充）
3. 客户料号
4. 货品图片
5. 品名（自动填充）
6. 货品规格
7. 附加属性
8. 数量 *
9. 包装换算
10. 包装单位
11. 重量单位
12. 包装净重
13. 包装毛重
14. 包装类型
15. 包装大小
16. 厂商备注
17. 预交日

**销售填写字段**（R-AB列）：
18. 单价 *
19. 未税本位币
20. 装箱数
21. 箱数
22. 包装方式
23. 纸卡编码
24. 水洗标编码
25. 外箱编码
26. 箱规
27. 体积
28. 摘要

---

## 📊 数据流向图

```
前端表单输入
    ↓
自动生成订单号 (SO20251031-XXX)
    ↓
填写客户信息（如果是新客户，自动创建）
    ↓
添加订单明细（28个字段）
    ↓
自动计算总金额
    ↓
提交到后端 API (POST /api/orders)
    ↓
后端保存到数据库
    ↓
管理员在后台查看 (/admin/orders)
    ↓
点击"导出"按钮
    ↓
后端生成Excel (GET /api/orders/:id/export)
    ↓
下载Excel文件（完整28列数据）
```

---

## ❓ 常见问题

### Q1: 前端页面打不开？
**A**: 检查前端服务是否运行：
```bash
cd code/frontend
pnpm run dev
```

### Q2: 提交订单报错？
**A**: 检查后端服务是否运行：
```bash
cd code/backend-api
pnpm run start:dev
```

### Q3: 产品下拉框是空的？
**A**: 数据库中需要有产品数据。当前应该有5个测试产品。

### Q4: 必须填写所有28个字段吗？
**A**: 不需要！只有产品、数量、单价是必填的。其他字段都是可选的，可以根据实际需要填写。

### Q5: 可以一次添加多个产品吗？
**A**: 可以！点击"+ 添加产品"按钮，可以添加无限多个订单明细。

### Q6: Excel导出的文件在哪里？
**A**: 浏览器默认下载文件夹，文件名格式：`SalesOrder_订单号_时间戳.xlsx`

### Q7: 如何查看Excel格式是否正确？
**A**: 打开Excel文件，应该看到：
- 第1行：公司名称
- 第2行：销售订单标题
- 第6行：28列表头（项、品号、客户料号...摘要）
- 第7行起：你输入的数据
- 完全匹配 `material/sample_table/sale_table.xls` 模板格式

---

## 🚀 快速测试流程

**5分钟快速测试**：

1. 打开前端：http://localhost:3000/order-confirmation
2. 保持默认订单号
3. 选择客户类型和订单类型
4. 填写客户信息（随便填写测试数据）
5. 选择一个产品
6. 输入数量（如：100）
7. 单价自动填充
8. 其他字段可以不填
9. 点击"确认订单"
10. 等待成功提示
11. 打开后台：http://localhost:3000/admin/orders
12. 找到刚才的订单
13. 点击"导出"
14. 检查下载的Excel文件

**完成！**

---

## 📝 重要提示

### ✅ 正确的理解
- **前端** = 客户下单页面（输入订单数据）
- **后台** = 管理员查看页面（查看订单、导出Excel）
- 前端输入 → 后端保存 → 后台查看和导出

### ❌ 不要混淆
- ~~前端不是用来查看订单的~~
- ~~后台不是用来输入订单的~~

### 🎯 核心流程
1. 客户在前端填写订单（28个字段）
2. 提交到后端保存
3. 管理员在后台查看和导出Excel

---

## 📚 技术文档

- **ORDER_API_FIELDS.md** - 完整的28个字段文档
- **code/frontend/src/app/(frontend)/order-confirmation/page.tsx** - 前端订单页面
- **code/frontend/src/app/admin/orders/page.tsx** - 后台管理页面
- **code/backend-api/src/modules/order/order.service.ts** - 后端订单服务

---

## 🎉 开始使用

**现在就访问前端页面创建你的第一个订单吧！**

```
http://localhost:3000/order-confirmation
```

祝使用愉快！如有任何问题，随时联系。
