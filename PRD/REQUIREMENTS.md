# LEMOPX 订单管理系统 - 需求文档 v2.0

## 📋 项目概述

### 项目背景
LEMOPX 是一家源头工厂，主营日用品（清洁工具，尤其是拖把等）。目前订单采用手写方式，需要将订单流程电子化，为业务员提供便捷的下单工具。

### 业务模式
- **B2B 业务员辅助下单系统**（非 B2C 电商）
- 业务员代客户下单（填写客户信息）
- **系统只有业务员和管理员使用**
- **❌ 不需要客户登录功能**
- **❌ 不需要在线支付功能**
- **❌ 不需要配送管理模块**
- **❌ 不需要库存管理模块**

### 核心目标
1. 从 ERP 导入产品数据
2. 简化业务员下单流程
3. 支持订单编辑和打印
4. 数字化管理订单数据

### 系统规模
- 并发用户：10-20 人（业务员）
- 商品数量：预计 50-200
- 订单量：预计 100-500/月

---

## 🔄 核心业务流程

### 产品管理流程

```
1. ERP系统建档
   - 在ERP中创建产品档案
   - 生成品号(SKU)
   - 录入产品信息(名称、组件、规格、图片等)

2. ERP导出产品表格
   - 固定格式的Excel/CSV
   - 包含：品号、产品名称、规格(含组件颜色)、图片URL等
   - 表格格式后续确认

3. 网站后台导入表格
   - 管理员上传ERP导出的表格
   - 系统自动解析数据
   - 产品信息导入数据库(默认"未上架"状态)

4. 后台选择上架产品
   - 根据品号选择需要上架的产品
   - 填写销售单价
   - 设置上架状态

5. 前端展示
   - 上架的产品显示在前端
   - 业务员可以浏览和下单
```

### 下单流程

```
1. 业务员登录系统
2. 浏览商品/搜索商品
3. 进入产品详情页
4. 选择组件颜色
5. 选择数量
6. 加入购物车
7. 重复步骤2-6（支持多个产品一起下单）
8. 进入购物车确认商品
9. 进入下单页
10. 填写客户信息
11. 填写订单参数（数量、箱数、纸卡编码、摘要、预交日等）
12. 预览订单确认页
13. 打印订单（可选）
14. 提交订单
```

### 订单管理流程

```
1. 查看历史订单
2. 搜索/筛选订单
3. 编辑订单
   - 修改客户信息
   - 修改订单参数
   - 增删改商品
4. 打印订单
5. 导出订单表格
```

---

## 👥 用户角色

### 1. 业务员（主要用户）⭐

**权限：**
- 浏览商品
- 下单（填写客户信息和订单参数）
- 查看和编辑自己的订单
- 打印订单
- 导出订单

### 2. 管理员 ⭐

**权限：**
- 导入ERP产品表格
- 管理商品（上架/下架、填写单价）
- 创建和管理业务员账号
- 查看、编辑所有订单
- 打印和导出订单
- 系统配置

---

## 🎯 功能模块

## 一、前端系统（业务员使用）

### 1.1 登录
- 账号密码登录
- 记住密码
- 忘记密码（管理员后台重置）

### 1.2 首页
- 品牌展示
- 精选产品展示
- 产品分类导航
- 快速搜索

### 1.3 产品列表页
- 产品网格展示
- **显示品号** ⭐
- 分类筛选
- 价格排序
- 显示所有组件的颜色圆圈
- 快速添加按钮

**注意：** 组件相同的多个品号（不同颜色组合）合并展示为一个产品卡片

### 1.4 产品详情页 ⭐核心

**组件化产品配置：**

产品由一个或多个组件组成，每个组件有多种颜色选项。

**重要逻辑：品号与颜色组合的关系** ⭐⭐

```
关键概念：
- 不同颜色组合 = 不同品号
- 组件相同的商品合并展示（前端视觉上是同一个产品）
- 选择不同颜色组合 = 显示对应的品号和图片

示例：
商品1: 拖把-黑杆白头蓝布 (品号: MOP-001)
商品2: 拖把-白杆白头蓝布 (品号: MOP-002)
商品3: 拖把-黑杆灰头绿布 (品号: MOP-003)

前端展示：
显示为一个"拖把"产品
- 拖把杆: ⚫黑色 ⚪白色
- 拖把头: ⚪白色 ⚫灰色
- 抹布: 🔵蓝色 🟢绿色

当用户选择：黑杆+白头+蓝布 → 显示品号: MOP-001 + 对应图片
当用户选择：白杆+白头+蓝布 → 显示品号: MOP-002 + 对应图片
当用户选择：黑杆+灰头+绿布 → 显示品号: MOP-003 + 对应图片
```

**示例：完整拖把**
```
拖把 = 拖把杆 + 拖把头 + 抹布

拖把杆：黑色、白色、灰色、金色
拖把头：白色、灰色
抹布：蓝色、绿色、粉色、黄色

选择颜色组合后：
- 显示对应品号（实时更新）
- 显示对应图片（实时切换）
- 显示价格
```

**功能：**
- 产品图片展示（主图+缩略图，根据颜色组合切换）
- **显示品号（实时更新）** ⭐
- 组件选择器（每个组件选择颜色）
- 颜色圆圈展示（支持16进制颜色）
- 数量选择器
- 加入购物车
- 产品描述

**移除：**
- ❌ 用户评分和评论区
- ❌ 推荐产品区

### 1.5 购物车页面 ⭐

**功能：**
- 商品列表展示（含组件颜色配置）
- **显示品号** ⭐
- 修改数量
- 删除商品
- 价格汇总
- 继续购物
- 去下单

### 1.6 下单页面 ⭐⭐核心页面

**客户信息（必填）：**
- 客户名称/公司名称
- 联系人
- 联系方式
- 收货地址

**订单参数（部分必填，部分选填）：**

**注意：完整字段列表后续提供**

当前已确认字段：
- 数量
- 箱数
- 纸卡编码（选填）
- 摘要（选填）
- 预交日（预计交货日期）
- 备注
- 其他订单字段...

**操作：**
- 预览订单
- 保存草稿
- 返回购物车

### 1.7 订单确认页 ⭐⭐核心页面

**功能：**
- 完整订单信息展示
- 可编辑所有信息（客户信息、订单参数、商品）
- **打印订单**（按模板格式）
- 提交订单

### 1.8 业务员工作台

**我的订单：**
- 查看历史订单
- 搜索/筛选订单
- 编辑订单
- 打印订单
- 导出订单
- 复制订单（快速重复下单）

**个人信息：**
- 查看和修改个人信息
- 修改密码

---

## 二、后台管理系统

### 2.1 管理员登录
- 账号密码登录
- 权限验证

### 2.2 仪表盘
- 今日订单数
- 本月订单数
- 订单趋势图
- 快捷操作入口

### 2.3 商品管理 ⭐核心

#### 2.3.1 从ERP导入产品 ⭐⭐核心中的核心

**导入流程：**
1. 管理员点击"导入产品"
2. 上传ERP导出的Excel/CSV文件
3. 系统自动解析表格
4. 显示导入结果（成功/失败数量）
5. 产品默认为"未上架"状态

**表格格式要求（待确认）：**
```
列名示例：
- 品号/SKU
- 产品名称
- 规格 (格式: 杆:黑色/白色;头:白色/灰色;布:蓝色/绿色)
- 主图URL
- 详情图URL (多个用;分隔)
- 分类
- 产品描述

注意：具体格式等待ERP确认后更新
```

#### 2.3.2 商品列表

**功能：**
- 搜索商品（名称/品号）
- 筛选（分类/状态：已上架/未上架）
- **批量操作（批量上架/批量下架/删除）** ⭐
- 导入产品
- 导出商品

**显示信息：**
- 商品图片
- 商品名称
- 品号(SKU) - 从ERP导入
- 销售单价
- 状态（已上架/未上架）
- 多选框（用于批量操作）
- 操作按钮

**批量操作说明：**
- 选择多个商品
- 批量上架（需填写统一单价）
- 批量下架
- 批量删除

#### 2.3.3 商品上架/编辑

**可编辑信息：**
- 销售单价（必填）
- 产品描述
- 状态：上架/下架
- 排序权重

**不可编辑（来自ERP）：**
- 品号(SKU)
- 产品名称
- 组件配置
- 颜色信息
- 图片

### 2.4 订单管理 ⭐核心

#### 2.4.1 订单列表

**筛选条件：**
- 下单时间范围
- 业务员
- 客户名称
- 订单号搜索

**显示信息：**
- 订单号
- 客户名称
- 业务员
- 下单时间
- 订单金额
- 操作（查看/编辑/打印/导出）

**批量操作：**
- 导出订单表格（Excel/CSV）
- 批量打印
- 批量删除

#### 2.4.2 订单详情/编辑 ⭐核心

**可查看和编辑的信息：**

1. 客户信息（可编辑）
   - 公司名称
   - 联系人
   - 联系方式
   - 收货地址

2. 订单参数（可编辑）
   - 数量
   - 箱数
   - 纸卡编码
   - 摘要
   - 预交日
   - 备注
   - 其他字段...

3. 商品明细（可编辑）
   - 商品列表
   - 组件配置详情（组件名 + 颜色）
   - 数量
   - 单价
   - 小计
   - 支持增删改商品

4. 价格信息
   - 商品总额
   - 订单总额

**操作按钮：**
- 保存修改
- 打印订单（按模板格式）
- 导出订单（Excel - 按模板格式）
- 删除订单

### 2.5 用户管理

#### 2.5.1 业务员管理

**功能：**
- 添加业务员（管理员专用）
- 编辑业务员信息
- 禁用/启用账号
- 重置密码
- 查看业务员订单统计

**信息字段：**
- 姓名
- 账号
- 手机号
- 邮箱
- 部门
- 状态

### 2.6 分类管理

**功能：**
- 添加/编辑/删除分类
- 分类排序
- 分类图标上传

**层级：**
- 一级分类：拖把系统、配件、清洁液等
- 二级分类：平板拖把、旋转拖把、蒸汽拖把等

### 2.7 系统设置

**基础设置：**
- 网站名称
- Logo
- 联系方式

**首页设置：**
- 轮播图管理
- 精选产品配置

---

## 三、数据结构

### 核心数据模型说明

**重要：品号与颜色组合的数据关系** ⭐⭐

```
方案：产品分组 + SKU变体

product_groups (产品组 - 用于前端合并展示)
  ├─ group_id: "GROUP-001"
  ├─ group_name: "LEMOPX Elite Mop"
  ├─ base_components: ["拖把杆", "拖把头", "抹布"]
  └─ variants → (多个SKU变体)
       ├─ SKU: MOP-001 (黑杆+白头+蓝布)
       ├─ SKU: MOP-002 (白杆+白头+蓝布)
       └─ SKU: MOP-003 (黑杆+灰头+绿布)

每个SKU变体包含：
- 唯一品号
- 颜色组合配置
- 专属图片
- 单价
```

### 数据库表设计

#### 1. users (用户表)
```
- id (主键)
- username (账号，唯一)
- password (密码，加密)
- role (角色: admin/salesman)
- name (姓名)
- phone (手机号)
- email (邮箱)
- department (部门)
- status (状态: active/inactive)
- created_at
- updated_at
```

#### 2. product_groups (产品组表 - 用于合并展示) ⭐新增
```
- id (主键)
- group_name (产品组名称，如"LEMOPX Elite Mop")
- category_id (分类ID)
- description (产品描述 - 可编辑)
- base_components (基础组件JSON，如["拖把杆","拖把头","抹布"])
- available_colors (所有可用颜色JSON - 从SKU variants汇总)
- sort_order (排序权重)
- status (状态: active/inactive - 组内任一SKU上架则为active)
- created_at
- updated_at
```

#### 3. products (商品SKU表 - 存储每个品号)
```
- id (主键)
- group_id (产品组ID - 外键) ⭐
- sku (SKU编码，唯一 - 从ERP导入)
- name (商品名称 - 从ERP导入)
- main_image (主图URL - 从ERP导入)
- detail_images (详情图JSON数组 - 从ERP导入)
- price (销售单价 - 上架时填写)
- color_combination (颜色组合JSON - 从ERP导入) ⭐
- status (状态: active/inactive)
- erp_imported (是否从ERP导入)
- erp_import_date (导入时间)
- created_at
- updated_at
```

**color_combination字段结构示例：**
```json
{
  "拖把杆": {"name": "黑色", "hex": "#000000"},
  "拖把头": {"name": "白色", "hex": "#FFFFFF"},
  "抹布": {"name": "蓝色", "hex": "#0000FF"}
}
```

#### 4. orders (订单表)
```
- id (主键)
- order_no (订单号，唯一)
- salesman_id (业务员ID)
- customer_name (客户名称/公司名称)
- customer_contact (联系人)
- customer_phone (联系方式)
- customer_address (收货地址)
- total_amount (订单总额)
- quantity (数量)
- box_count (箱数)
- card_code (纸卡编码)
- summary (摘要)
- delivery_date (预交日)
- notes (备注)
- 【其他订单字段...待后续确认】
- created_at
- updated_at
```

#### 5. order_items (订单商品明细表)
```
- id (主键)
- order_id (订单ID)
- product_id (商品ID)
- product_name (商品名称，冗余存储)
- product_sku (商品SKU，冗余存储)
- selected_config (选择的组件配置，JSON)
- quantity (数量)
- unit_price (单价)
- subtotal (小计)
```

**selected_config示例：**
```json
{
  "components": [
    {
      "name": "拖把杆",
      "color": "黑色",
      "colorHex": "#000000"
    },
    {
      "name": "拖把头",
      "color": "白色",
      "colorHex": "#FFFFFF"
    }
  ]
}
```

#### 6. categories (分类表)
```
- id (主键)
- name (分类名称)
- parent_id (父分类ID)
- icon (图标URL)
- sort_order (排序)
- created_at
```

---

## 四、技术选型

### 前端
- Next.js 14（React框架）
- TypeScript
- Tailwind CSS（保持UI设计风格）
- Zustand（状态管理）
- Axios（HTTP客户端）

### 后端
- Next.js API Routes 或 Node.js + Express
- TypeScript
- PostgreSQL（关系型数据库）
- Prisma ORM
- JWT（认证）
- xlsx（Excel文件处理）

### 文件存储
- 本地存储（开发）
- 阿里云 OSS（生产）

---

## 五、开发优先级

### Phase 1：核心功能（3-4周）

**后台优先：**
1. 管理员登录
2. 从ERP导入产品功能 ⭐核心
3. 商品管理（上架/下架/填写单价）
4. 分类管理
5. 业务员账号管理

**前台核心：**
6. 业务员登录
7. 产品列表（展示组件颜色）
8. 产品详情（组件颜色选择）⭐核心
9. 购物车
10. 下单页面（填写客户信息和订单参数）⭐核心
11. 订单确认页（编辑+打印）⭐核心
12. 订单提交

**订单管理：**
13. 后台订单列表
14. 订单详情/编辑 ⭐核心
15. 打印订单功能 ⭐
16. 导出订单表格 ⭐

### Phase 2：增强功能（1-2周）
1. 业务员工作台
2. 订单历史查询
3. 订单复制功能
4. 数据统计报表
5. 批量操作优化

---

## 六、重要说明

### 1. 关于品号与颜色组合 ⭐⭐核心逻辑

```
关键规则：
✅ 不同颜色组合 = 不同品号(SKU)
✅ ERP会为每个颜色组合生成唯一品号
✅ 前端合并展示：组件相同的SKU合并为一个产品
✅ 用户选择颜色组合后，实时显示对应品号和图片
✅ 每个品号有自己的图片和单价

数据导入逻辑：
1. ERP导出时，每个品号是一行数据
2. 系统自动识别组件相同的SKU，自动分组
3. 创建product_group（产品组）
4. 每个品号作为一个product（SKU变体）
5. 前端从product_group读取，展示合并后的产品

前端展示逻辑：
1. 产品列表：显示product_group（合并后的产品）
2. 产品详情：用户选择颜色组合
3. 实时匹配对应的SKU，显示品号和图片
4. 加入购物车时，记录具体的SKU品号
```

### 2. 关于ERP对接
- ✅ 品号由ERP生成，网站不生成
- ✅ 产品数据从ERP导入
- ✅ 通过Excel/CSV表格批量导入
- ✅ 表格格式待ERP确认后更新

### 3. 关于订单字段
- ✅ 当前已确认：数量、箱数、纸卡编码、摘要、预交日、备注
- ✅ 完整字段列表后续提供
- ✅ 订单支持全部编辑（客户信息、订单参数、商品）

### 4. 关于打印和导出
- ✅ 打印模板格式后续提供
- ✅ 导出表格格式后续提供
- ✅ 包含所有订单信息

### 5. 关于批量操作
- ✅ 后台支持商品批量上架
- ✅ 后台支持商品批量下架
- ✅ 批量上架时需填写统一单价

### 6. 不需要的模块
- ❌ 客户登录功能
- ❌ 在线支付功能
- ❌ 配送管理模块
- ❌ 库存管理模块
- ❌ 用户评分和评论
- ❌ 推荐产品功能

---

## 七、待确认事项

### 1. ERP表格格式
- [ ] 确认Excel/CSV表格的确切列名和格式
- [ ] 确认规格字段的解析规则
- [ ] 确认图片URL的格式

### 2. 订单字段
- [ ] 提供完整的订单字段列表
- [ ] 明确哪些字段必填，哪些选填
- [ ] 确认字段的数据类型和格式

### 3. 打印模板
- [ ] 提供订单打印模板格式
- [ ] 确认打印内容和布局

### 4. 导出模板
- [ ] 提供订单导出表格的模板格式
- [ ] 确认导出的字段和顺序

---

**文档版本：** v2.0
**创建日期：** 2025-10-25
**最后更新：** 2025-10-25
**状态：** 需求确认中
